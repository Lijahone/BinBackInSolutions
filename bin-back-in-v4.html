<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bin Back In Solutions</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
  :root{--bg:#ffffff;--ink:#0f172a;--muted:#6b7280;--border:#e5e7eb;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);padding:14px 16px;display:flex;align-items:center;gap:10px;z-index:10}
  .brand{font-weight:800;font-size:18px}
  .spacer{flex:1}
  .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer}
  main{max-width:900px;margin:0 auto;padding:16px}
  .tile{border:1px solid var(--border);border-radius:14px;padding:18px;background:#fff;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
  .tile:active{transform:scale(.99)}
  .tile .title{font-size:18px;font-weight:800}
  .tile .meta{color:var(--muted);font-size:12px;margin-top:4px}
  .section{background:#fff;border:1px solid var(--border);border-radius:14px;padding:14px}
  .addr{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:8px}
  .addr .name{font-weight:700}
  .badge{border:1px solid var(--border);border-radius:999px;padding:6px 10px;display:inline-flex;align-items:center;gap:6px}
  .map{border:1px solid var(--border);border-radius:999px;padding:6px 10px;text-decoration:none}
  #homeHint{color:var(--muted);font-size:12px;margin-top:8px}
  #back{display:none}
</style>
</head>
<body>
<header>
  <button id="back" class="btn">‚Üê Back</button>
  <div class="brand">Bin Back In Solutions</div>
  <div class="spacer"></div>
  <button id="export" class="btn">Export</button>
  <input id="file" type="file" accept=".json" style="display:none">
  <button id="importBtn" class="btn">Import</button>
</header>
<main>
  <!-- HOME -->
  <section id="home">
    <div class="section" style="margin-bottom:12px">
      <div class="tile" id="regionTile">
        <div>
          <div class="title">Queenstown</div>
          <div class="meta" id="addrCountMeta">0 addresses</div>
        </div>
        <div class="badge">Open</div>
      </div>
      <div id="homeHint">Tap the tile to open your address list.</div>
    </div>
  </section>

  <!-- REGION LIST -->
  <section id="region" style="display:none">
    <div class="section">
      <h2 style="margin:8px 0 12px 0">Queenstown</h2>
      <div id="list"></div>
    </div>
  </section>
</main>

<script>
  const SEED = __SEED__;
  const $ = s => document.querySelector(s);
  const home = $('#home'), region = $('#region'), back=$('#back');
  const listEl = $('#list');
  const addrCountMeta = $('#addrCountMeta');
  const LS='bbi_v4_state';

  // Initialize state (persist In/Out)
  let state = null; try{ state = JSON.parse(localStorage.getItem(LS)); }catch(e){}
  if(!state){
    state = {addresses: SEED[0].addresses.map(a=>({address:a.address,out:false,back:false}))};
    localStorage.setItem(LS, JSON.stringify(state));
  }

  function save(){ localStorage.setItem(LS, JSON.stringify(state)); }
  function mapURL(a){ return 'https://www.google.com/maps/search/?api=1&query='+encodeURIComponent(a+', Queenstown'); }

  function renderHome(){
    addrCountMeta.textContent = state.addresses.length + ' addresses';
    home.style.display='';
    region.style.display='none';
    back.style.display='none';
  }

  function renderRegion(){
    listEl.innerHTML='';
    state.addresses.forEach((a,i)=>{
      const row = document.createElement('div');
      row.className='addr';
      row.innerHTML = '<div class="name">'+a.address+'</div>' +
        '<div style="display:flex;gap:8px;align-items:center">' +
        '<label class="badge"><input type="checkbox" data-act="out" data-i="'+i+'" '+(a.out?'checked':'')+'> Out</label>'+
        '<label class="badge"><input type="checkbox" data-act="back" data-i="'+i+'" '+(a.back?'checked':'')+'> Back</label>'+
        '<a class="map" href="'+mapURL(a.address)+'" target="_blank" rel="noopener">Map</a>' +
        '</div>';
      listEl.appendChild(row);
    });
    home.style.display='none';
    region.style.display='';
    back.style.display='inline-block';
  }

  // Open region when tile tapped
  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('regionTile').addEventListener('click', renderRegion);
  });
  back.addEventListener('click', renderHome);

  // Toggle checkboxes
  listEl.addEventListener('change', (e)=>{
    const cb = e.target.closest('input[type=checkbox]'); if(!cb) return;
    const i = Number(cb.dataset.i);
    const act = cb.dataset.act;
    state.addresses[i][act] = cb.checked;
    save();
  });

  // Export/Import
  document.getElementById('export').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'bin-back-in-v4.json';
    a.click();
    URL.revokeObjectURL(a.href);
  });
  document.getElementById('importBtn').addEventListener('click', ()=>document.getElementById('file').click());
  document.getElementById('file').addEventListener('change', (e)=>{
    const f=e.target.files[0]; if(!f) return;
    const rd=new FileReader();
    rd.onload=()=>{
      try{
        const data = JSON.parse(rd.result);
        if(Array.isArray(data.addresses)){ state=data; save(); renderHome(); }
        else alert('Invalid file');
      }catch(err){ alert('Could not read file'); }
    };
    rd.readAsText(f);
    e.target.value='';
  });

  // First render
  renderHome();
</script>
<script>const __SEED__ = [{"name": "Queenstown", "addresses": [{"address": "30 Woodlands Close"}, {"address": "6 Goldrush Way"}, {"address": "20 Goldleaf"}, {"address": "2/64 Marina Drive"}, {"address": "1/47 Lomond Cres"}, {"address": "2/11 Gum Lane"}, {"address": "22C Malaghan Street"}, {"address": "78 Highview"}, {"address": "70 Panorama Terrace"}, {"address": "7 Peregrine Place"}, {"address": "101 Hensman Road"}, {"address": "18 Amber Close"}, {"address": "6 Redfern Terrace"}, {"address": "14 Cumberland Road"}, {"address": "12 Corriedale Road"}, {"address": "42 Muster Road"}]}];</script>
</body>
</html>
